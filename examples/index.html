<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=375, initial-scale=1.0, maximum-scale=1.0 user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>YuumiRequest</title>
  <script src="index.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <input type="file">
  <script>
    var ISOYU = new YuumiRequest({
      baseURI: 'https://api.isoyu.com'
    })

    ISOYU.interceptors.response((data) => {
      if (data && data.response) {
        return JSON.parse(data.response)
      }

      return data
    })

    window.onload = function () {
      var cancelToken = {}

      for (var i = 0; i < 10; i++) {
        (function (index) {
          ISOYU.get('/api/picture/index' + (index === 4 ? index : ''), {
            page: index,
            per_page: 1
          }, {
            // timeout: 1000,
            level: index === 6 ? 'low': undefined,
            cancelToken: index === 2 || index === 7 ? function (cancel) {
              cancelToken[index] = cancel
            } : undefined
          }).then(function (res) {
            console.log(res)
          }).catch(function (error) {
            console.error(error.message)
          })

          if (cancelToken[index]) {
            cancelToken[index]()
          }

          // setTimeout(function () {
          //   if (cancelToken[index]) {
          //     cancelToken[index]()
          //   }
          // }, 100)
        })(i + 1);
      }
    }
  </script>
</body>

</html>